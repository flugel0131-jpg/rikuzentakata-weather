<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é™¸å‰é«˜ç”°å¸‚ æ°—è±¡æ³¨æ„å ±é€šçŸ¥</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<h1>é™¸å‰é«˜ç”°å¸‚ æ°—è±¡æ³¨æ„å ±</h1>
<p>å¯¾è±¡ï¼š</p>
<ul>
<li>é™¸ä¸Šã®å¼·é¢¨æ³¨æ„å ±ï¼ˆç™ºè¡¨ï¼è§£é™¤ï¼‰</li>
<li>ä¹¾ç‡¥æ³¨æ„å ±ï¼ˆç™ºè¡¨ï¼è§£é™¤ï¼‰</li>
</ul>

<button onclick="requestNotify()">ğŸ”” é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>

<ul id="log"></ul>

<script>
let last = {};

function requestNotify(){
  Notification.requestPermission().then(p=>{
    if(p==="granted"){
      alert("é€šçŸ¥ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ");
    }
  });
}

async function check(){
  const res = await fetch("https://api.alert-jp.org/api/v1/alerts?limit=100");
  const data = await res.json();

  data.forEach(a=>{
    if(!a.area?.includes("é™¸å‰é«˜ç”°å¸‚")) return;
    if(!["å¼·é¢¨æ³¨æ„å ±","ä¹¾ç‡¥æ³¨æ„å ±"].includes(a.type)) return;

    const key = a.type;
    const status = a.status;

    if(last[key] !== status){
      new Notification(`é™¸å‰é«˜ç”°å¸‚ ${a.type}`,{
        body: status==="ç™ºè¡¨" ? "æ³¨æ„å ±ãŒç™ºè¡¨ã•ã‚Œã¾ã—ãŸ" : "æ³¨æ„å ±ãŒè§£é™¤ã•ã‚Œã¾ã—ãŸ"
      });

      last[key] = status;

      const li = document.createElement("li");
      li.textContent = `${new Date().toLocaleString()} ${a.type}ï¼š${status}`;
      document.getElementById("log").prepend(li);
    }
  });
}

setInterval(check, 300000); // 5åˆ†
check();
</script>
</body>
</html>
